import os
import random
import threading
from http.server import BaseHTTPRequestHandler, HTTPServer
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, filters, ContextTypes

# –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ —ç—Ç–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é:
TARGET_USERNAME = "@Habib471"

# –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞ (0.4 = 40%)
RESPONSE_CHANCE = 0.4

# –ü–æ—ç—Ç–∏—á–Ω—ã–µ —Ä–æ–º–∞–Ω—Ç–∏—á–Ω—ã–µ —Ñ—Ä–∞–∑—ã —Å —ç–º–æ–¥–∑–∏ üíû
LOVE_PHRASES = [
    "–¢—ã ‚Äî –∫–∞–∫ —É—Ç—Ä–æ –ø–æ—Å–ª–µ –¥–æ–ª–≥–æ–π –Ω–æ—á–∏, —Ç–∏—Ö–∞—è –∏ —Ç—ë–ø–ª–∞—è üåÖ",
    "–ö–æ–≥–¥–∞ —Ç—ã —É–ª—ã–±–∞–µ—à—å—Å—è, –≤–µ—Å—å –º–∏—Ä –±—É–¥—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –¥–æ–±—Ä–µ–µ üíû",
    "–í –∫–∞–∂–¥–æ–º –¥—ã—Ö–∞–Ω–∏–∏ –º–æ–∏—Ö –º—ã—Å–ª–µ–π –∂–∏–≤—ë—à—å —Ç—ã üí´",
    "–¢—ã ‚Äî —Å–≤–µ—Ç, —á—Ç–æ –Ω–µ –≥–∞—Å–Ω–µ—Ç –¥–∞–∂–µ –≤ —Å–∞–º—ã–µ —Ç—ë–º–Ω—ã–µ –¥–Ω–∏ üåô",
    "–ï—Å–ª–∏ –±—ã —Å–ª–æ–≤–∞ –º–æ–≥–ª–∏ –∫–∞—Å–∞—Ç—å—Å—è, —è –±—ã –æ–±–Ω—è–ª —Ç–µ–±—è –∫–∞–∂–¥—ã–º –∏–∑ –Ω–∏—Ö üíå",
    "–¢—ã ‚Äî –º—É–∑—ã–∫–∞ –º–æ–µ–≥–æ —Å–µ—Ä–¥—Ü–∞, –Ω–µ–∂–Ω–∞—è –∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–∞—è üéµ",
    "–¢–≤–æ—ë –∏–º—è ‚Äî –∫–∞–∫ —à—ë–ø–æ—Ç –≤–µ—Å–Ω—ã –≤ —Å–µ—Ä–¥—Ü–µ üå∏",
    "–¢—ã –Ω–∞–ø–æ–ª–Ω—è–µ—à—å —Ç–∏—à–∏–Ω—É —Å–º—ã—Å–ª–æ–º, –∞ –º–æ—é –¥—É—à—É ‚Äî —Å–≤–µ—Ç–æ–º ‚òÄÔ∏è",
    "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –≤–µ—Ç–µ—Ä –ø–æ—ë—Ç –æ –ª—é–±–≤–∏ üíó",
    "–¢—ã ‚Äî –º–æ–π —Å–∞–º—ã–π –∫—Ä–∞—Å–∏–≤—ã–π —Å–ª—É—á–∞–π –≤ –∂–∏–∑–Ω–∏ üíï",
    "–¢–≤–æ–∏ –≥–ª–∞–∑–∞ ‚Äî –º–æ–π —Å–∞–º—ã–π –ª—é–±–∏–º—ã–π –∑–∞–∫–∞—Ç üåÖ",
    "–¢—ã ‚Äî —Å—Ç—Ä–æ—á–∫–∞, –Ω–∞–ø–∏—Å–∞–Ω–Ω–∞—è —Å—É–¥—å–±–æ–π –æ –Ω–µ–∂–Ω–æ—Å—Ç–∏ ‚ú®",
    "–¢—ã —Å–æ–≥—Ä–µ–≤–∞–µ—à—å –¥–∞–∂–µ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –º–æ–ª—á–∏—à—å üí≠",
    "–° –∫–∞–∂–¥—ã–º –¥–Ω—ë–º —è –≤—Å—ë –±–æ–ª—å—à–µ –ø–æ–Ω–∏–º–∞—é, —á—Ç–æ –±–µ–∑ —Ç–µ–±—è –Ω–µ –º–æ–≥—É üíû",
    "–¢—ã ‚Äî –≤–¥–æ—Ö, –ø–æ—Å–ª–µ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ —Ö–æ—á–µ—Ç—Å—è –≤—ã–¥—ã—Ö–∞—Ç—å üíñ",
    "–ö–∞–∂–¥–æ–µ —Ç–≤–æ—ë —Å–ª–æ–≤–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥ –≤ –º–æ—ë–º —Å–µ—Ä–¥—Ü–µ üå∑",
    "–¢—ã ‚Äî –∫–∞–∫ –∑–≤–µ–∑–¥–∞, —á—Ç–æ –æ—Å–≤–µ—â–∞–µ—Ç –º–æ—é –≤—Å–µ–ª–µ–Ω–Ω—É—é üí´",
    "–° –ª—é–±–æ–≤—å—é –∫ —Ç–µ–±–µ –≤—Å—ë —Å—Ç–∞–ª–æ —è—Å–Ω–µ–µ, —Å–≤–µ—Ç–ª–µ–µ, —Ç–∏—à–µ üíå",
    "–¢—ã ‚Äî –º–æ–π —Å–º—ã—Å–ª, –º–æ–π –ø–æ–∫–æ–π –∏ –º–æ—ë —á—É–¥–æ üíó",
    "–ï—Å–ª–∏ –±—ã –ª—é–±–æ–≤—å –∏–º–µ–ª–∞ –∏–º—è ‚Äî –æ–Ω–∞ –∑–≤–∞–ª–∞—Å—å –±—ã —Ç–æ–±–æ–π üíû",
]

# –í–æ–∑–º–æ–∂–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∏ –æ—Ç –ê–ø–∞—á–∏
SIGNATURES = [
    "–ê–ø–∞—á–∏ —Ç–µ–±—è –ª—é–±–∏—Ç ‚ù§Ô∏è",
    "–° –ª—é–±–æ–≤—å—é, —Ç–≤–æ–π –ê–ø–∞—á–∏ üíû",
    "–¢—ã –≤ —Å–µ—Ä–¥—Ü–µ –ê–ø–∞—á–∏ –Ω–∞–≤—Å–µ–≥–¥–∞ üíó",
    "–ü–æ–ª—é–±–∏ –ê–ø–∞—á–∏, –∫–∞–∫ –æ–Ω —Ç–µ–±—è üåô",
    "–û—Ç –ê–ø–∞—á–∏ —Å —Ç–µ–ø–ª–æ–º üíå",
]

# === –ú–∏–Ω–∏-–≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Render (—á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ç–∞—Ä–∏—Ñ) ===
def run_web():
    class Handler(BaseHTTPRequestHandler):
        def do_GET(self):
            self.send_response(200)
            self.end_headers()
            self.wfile.write(b"üíû LoveBot is running on Render üíû")
    port = int(os.environ.get("PORT", 10000))
    HTTPServer(("0.0.0.0", port), Handler).serve_forever()

# –ó–∞–ø—É—Å–∫–∞–µ–º –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
threading.Thread(target=run_web, daemon=True).start()
# ================================================================


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.from_user:
        return

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –Ω—É–∂–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≤ –≥—Ä—É–ø–ø–µ
    if message.chat.type in ["group", "supergroup"] and message.from_user.username == TARGET_USERNAME[1:]:
        if random.random() <= RESPONSE_CHANCE:
            phrase = random.choice(LOVE_PHRASES)
            signature = random.choice(SIGNATURES)
            response = f"{phrase}\n\n{signature}"
            await message.reply_text(response)


def main():
    BOT_TOKEN = os.environ.get("BOT_TOKEN")
    if not BOT_TOKEN:
        print("‚ùå –û—à–∏–±–∫–∞: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
        return

    app = ApplicationBuilder().token(BOT_TOKEN).build()
    app.add_handler(MessageHandler(filters.ALL, handle_message))
    print("üíû LoveBot by Apachi –∑–∞–ø—É—â–µ–Ω –∏ –∂–¥—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–π...")
    app.run_polling()


if __name__ == "__main__":
    main()

