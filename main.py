import os
import random
import threading
from http.server import BaseHTTPRequestHandler, HTTPServer
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, CommandHandler, filters, ContextTypes

# ------------------------
# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
# ------------------------
TARGET_USERNAMES = ["Habib471"]       # –†–æ–º–∞–Ω—Ç–∏–∫–∞
NEGATIVE_USERNAMES = ["vkhich1ro"]    # –ù–µ–≥–∞—Ç–∏–≤

# ------------------------
# –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã üíû
# ------------------------
LOVE_PHRASES = [
    "–¢—ã ‚Äî –º–æ—ë –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –Ω–µ–∂–Ω–æ–µ –∫–∞–∫ –¥—ã—Ö–∞–Ω–∏–µ –≤–µ—Å–Ω—ã üå∑",
    "–° —Ç–æ–±–æ–π –≤—Å—ë –≤–æ–∫—Ä—É–≥ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–º—ã—Å–ª–æ–º üí´",
    "–¢—ã ‚Äî –º–æ—è –º–µ–ª–æ–¥–∏—è —Å—á–∞—Å—Ç—å—è, —Ç–∏—Ö–∞—è –∏ –≤–µ—á–Ω–∞—è üé∂",
    "–í –∫–∞–∂–¥–æ–º –ª—É—á–µ —Å–æ–ª–Ω—Ü–∞ —è –≤–∏–∂—É —Ç–≤–æ–π —Å–≤–µ—Ç ‚òÄÔ∏è",
    "–¢—ã ‚Äî —à—ë–ø–æ—Ç –Ω–µ–∂–Ω–æ—Å—Ç–∏ –≤ —à—É–º–µ –º–∏—Ä–∞ üå∏",
    "–ö–∞–∂–¥–∞—è –º—ã—Å–ª—å –æ —Ç–µ–±–µ ‚Äî –∫–∞–∫ —É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∞—Å—Å–≤–µ—Ç üåÖ",
    "–° —Ç–æ–±–æ–π –¥–∞–∂–µ —Ç–∏—à–∏–Ω–∞ –∑–≤—É—á–∏—Ç –ø—Ä–µ–∫—Ä–∞—Å–Ω–µ–µ üíû",
    "–¢—ã ‚Äî –¥—ã—Ö–∞–Ω–∏–µ —Å–≤–µ—Ç–∞ –≤ –º–æ—ë–º —Å–µ—Ä–¥—Ü–µ ‚ú®",
    "–í —Ç–≤–æ–∏—Ö –≥–ª–∞–∑–∞—Ö —Å–ø—Ä—è—Ç–∞–Ω–æ –Ω–µ–±–æ –∏ —Ç–µ–ø–ª–æ üåå",
    "–¢—ã ‚Äî –º–µ—á—Ç–∞, –∫–æ—Ç–æ—Ä–∞—è —Å—Ç–∞–ª–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é üíó",
    "–¢—ã ‚Äî –º–æ—è —Ä–∞–¥–æ—Å—Ç—å –∏ —Å–≤–µ—Ç –≤ —Ç–µ–º–Ω–æ—Ç–µ üåü",
    "–¢—ã ‚Äî –º—è–≥–∫–æ—Å—Ç—å –≤ —ç—Ç–æ–º –∂–µ—Å—Ç–æ–∫–æ–º –º–∏—Ä–µ üíñ",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞ ‚Äî —á—É–¥–æ üí´",
    "–¢—ã ‚Äî –ª—é–±–æ–≤—å, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å üíï",
    "–¢—ã ‚Äî –Ω–µ–∂–Ω–æ—Å—Ç—å, —Å–æ–≥—Ä–µ–≤–∞—é—â–∞—è –¥—É—à—É üå∑",
    "–¢—ã ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –º–æ–µ–≥–æ —Å–µ—Ä–¥—Ü–∞ üíó",
    "–¢—ã ‚Äî –º–æ–π —Å–≤–µ—Ç –≤ –∫–æ–Ω—Ü–µ —Ç—É–Ω–Ω–µ–ª—è üåÖ",
    "–¢—ã ‚Äî –º—É–∑—ã–∫–∞ –≤ –º–æ–∏—Ö –º—ã—Å–ª—è—Ö üé∂",
    "–¢—ã ‚Äî —Å—á–∞—Å—Ç—å–µ, —á—Ç–æ —Å—Ç–∞–ª–æ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é üíû",
    "–¢—ã ‚Äî –º–µ—á—Ç–∞, –≤–æ–ø–ª–æ—â—ë–Ω–Ω–∞—è –≤ –∂–∏–∑–Ω—å üå∏",
]

# –ü–æ–¥–ø–∏—Å–∏ –∫ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
SIGNATURES = [
    "–ê–ø–∞—á–∏ —Ç–µ–±—è –ª—é–±–∏—Ç ‚ù§Ô∏è",
    "–¢—ã –≤ —Å–µ—Ä–¥—Ü–µ –ê–ø–∞—á–∏ –Ω–∞–≤—Å–µ–≥–¥–∞ üíó",
    "–ü–æ–ª—é–±–∏ –ê–ø–∞—á–∏, –∫–∞–∫ –æ–Ω —Ç–µ–±—è üåô",
    "–û—Ç –ê–ø–∞—á–∏ —Å —Ç–µ–ø–ª–æ–º üíå",
]

# ------------------------
# –ñ—ë—Å—Ç–∫–∏–µ –Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–µ —Ñ—Ä–∞–∑—ã üò°
# ------------------------
HARD_NEGATIVE_WORDS = [
    "–¢—ã –∞–±—Å–æ–ª—é—Ç–Ω–æ –Ω–µ–Ω–∞–¥—ë–∂–Ω—ã–π –∏ —Ä–∞–∑–¥—Ä–∞–∂–∞—é—â–∏–π —á–µ–ª–æ–≤–µ–∫!",
    "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Ä–ø–µ—Ç—å —Ç–≤–æ—é –±–µ–∑–¥—É—à–Ω—É—é –±–æ–ª—Ç–æ–≤–Ω—é!",
    "–¢–≤–æ—è –ø—É—Å—Ç–∞—è –±–æ–ª—Ç–æ–≤–Ω—è —É—Ç–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –≤–æ–∫—Ä—É–≥!",
    "–¢—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–∑–¥–∞—ë—à—å —Ö–∞–æ—Å –∏ —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ!",
    "–¢–≤–æ—ë –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ ‚Äî —ç—Ç–æ –∫–∞–∫ —Å–µ—Ä—ã–π —Ç—É–º–∞–Ω —É–Ω—ã–Ω–∏—è!",
    "–¢—ã ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –≤—Å–µ—Ö –ø—Ä–æ–±–ª–µ–º –∏ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–µ–π!",
    "–ù–∏–∫–∞–∫–∞—è –ª–æ–≥–∏–∫–∞ –Ω–µ —Å–ø–∞—Å–∞–µ—Ç —Ç–≤–æ—é –±–µ–∑—É–º–Ω—É—é –≥–æ–ª–æ–≤—É!",
    "–¢—ã –±–µ–∑–¥–∞—Ä–Ω–æ —Ç—Ä–∞—Ç–∏—à—å –≤—Ä–µ–º—è –∏ —á—É–∂–∏–µ –Ω–µ—Ä–≤—ã!",
    "–¢–≤–æ–∏ –ø–æ—Å—Ç—É–ø–∫–∏ –≤—ã–∑—ã–≤–∞—é—Ç —Ç–æ–ª—å–∫–æ –∑–ª–æ—Å—Ç—å –∏ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ!",
    "–¢—ã –Ω–µ —Å–ø–æ—Å–æ–±–µ–Ω –Ω–∞ –¥–æ–±—Ä–æ—Ç—É –∏ —á–µ—Å—Ç–Ω–æ—Å—Ç—å!",
    "–¢–≤–æ—è –ª–∂–∏–≤–æ—Å—Ç—å –ø–æ—Ä–∞–∂–∞–µ—Ç –≤—Å–µ—Ö –ø–æ–¥—Ä—è–¥!",
    "–¢—ã –Ω–µ—Å—ë—à—å —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ –∫—É–¥–∞ –±—ã –Ω–∏ –ø–æ—à—ë–ª!",
    "–ù–µ–≤—ã–Ω–æ—Å–∏–º–æ —Å–ª—É—à–∞—Ç—å —Ç–≤–æ—é –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—É—é —Ä–µ—á—å!",
    "–¢—ã ‚Äî –Ω–∞—Å—Ç–æ—è—â–∞—è –≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å –¥–ª—è –≤—Å–µ—Ö!",
    "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ —Ç–æ–ª—å–∫–æ —Ä–∞–∑–¥—Ä–∞–∂–∞—é—Ç –∏ –æ—Å–∫–æ—Ä–±–ª—è—é—Ç!",
    "–¢—ã –ø–æ—Å—Ç–æ—è–Ω–Ω–æ —Å–æ–∑–¥–∞—ë—à—å –¥—Ä–∞–º—É –∏ –Ω–µ–≥–∞—Ç–∏–≤!",
    "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ –ø–æ–Ω—è—Ç—å —Ç–≤–æ—é –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É!",
    "–¢—ã –∫–∞–∫ —á—ë—Ä–Ω–∞—è –¥—ã—Ä–∞ –¥–ª—è —Å—á–∞—Å—Ç—å—è –¥—Ä—É–≥–∏—Ö!",
    "–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è —Ä–∞–∑—Ä—É—à–∞—é—Ç –≤—Å—ë –≤–æ–∫—Ä—É–≥!",
    "–¢—ã ‚Äî –≤–æ–ø–ª–æ—â–µ–Ω–∏–µ —Ö–∞–æ—Å–∞ –∏ –±–µ–∑—Ä–∞–∑–ª–∏—á–∏—è!",
    "–¢—ã ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ —Ñ—Ä—É—Å—Ç—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞–∫–æ–º—ã—Ö!",
    "–¢–≤–æ—ë –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ä—Ç–∏—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ –æ–∫—Ä—É–∂–∞—é—â–∏–º!",
    "–¢—ã —Å–ª–æ–≤–Ω–æ –º–∞–≥–Ω–∏—Ç –¥–ª—è –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–µ–π –∏ –ø—Ä–æ–±–ª–µ–º!",
    "–ù–µ–≤–æ–∑–º–æ–∂–Ω–æ —Ç–µ—Ä–ø–µ—Ç—å —Ç–≤–æ—é —Å–∞–º–æ–≤–ª—é–±–ª—ë–Ω–Ω–æ—Å—Ç—å!",
    "–¢–≤–æ—è –∂–∞–¥–Ω–æ—Å—Ç—å –∏ —ç–≥–æ–∏–∑–º –ø–æ—Ä–∞–∂–∞—é—Ç –≤—Å–µ—Ö!",
    "–¢—ã ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –≤—Å–µ—Ö —Å—Å–æ—Ä –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤!",
    "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ —Ä–∞–Ω—è—Ç –±–æ–ª—å—à–µ, —á–µ–º –¥–µ–π—Å—Ç–≤–∏—è!",
    "–¢—ã —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞—ë—à—å —Å—Ç—Ä–µ—Å—Å –∏ —Ç—Ä–µ–≤–æ–≥—É!",
    "–¢–≤–æ—è –≥–ª—É–ø–æ—Å—Ç—å –ø–æ—Ä–∞–∂–∞–µ—Ç –≤–æ–æ–±—Ä–∞–∂–µ–Ω–∏–µ!",
    "–¢—ã ‚Äî –ø–æ–ª–Ω–æ–µ —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞–Ω–∏–µ –≤–æ –≤—Å–µ—Ö —Å–º—ã—Å–ª–∞—Ö!",
    "–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –≤—ã–∑—ã–≤–∞—é—Ç —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ!",
    "–¢—ã —Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—å –≤—Å–µ–≥–æ –ø–æ–∑–∏—Ç–∏–≤–Ω–æ–≥–æ –≤–æ–∫—Ä—É–≥!",
    "–¢—ã –±–µ–∑–¥–∞—Ä–Ω–æ —Ç—Ä–∞—Ç–∏—à—å —á—É–∂–æ–µ –≤—Ä–µ–º—è!",
    "–ù–µ–≤—ã–Ω–æ—Å–∏–º–æ –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è —Ä—è–¥–æ–º —Å —Ç–æ–±–æ–π!",
    "–¢—ã –∫–∞–∫ —á—É–º–∞ –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –¥—Ä—É–≥–∏—Ö –ª—é–¥–µ–π!",
    "–¢—ã –ø—Ä–µ–≤—Ä–∞—â–∞–µ—à—å —Ä–∞–¥–æ—Å—Ç—å –≤ —Å–∫—É–∫—É –∏ –≥—Ä—É—Å—Ç—å!",
    "–¢–≤–æ—è –±–µ–∑–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –ø–æ—Ä–∞–∂–∞–µ—Ç –≤—Å–µ—Ö!",
    "–¢—ã ‚Äî –ø–æ—Å—Ç–æ—è–Ω–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ö–∞–æ—Å–∞!",
    "–¢–≤–æ—è –ª–µ–Ω—å –∏ —Ä–∞–≤–Ω–æ–¥—É—à–∏–µ —Ä–∞–∑–¥—Ä–∞–∂–∞—é—Ç!",
    "–¢—ã ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫ –∫–æ–º–∞–Ω–¥—ã!",
    "–¢–≤–æ–∏ –¥–µ–π—Å—Ç–≤–∏—è –ª–∏—à–µ–Ω—ã —Å–º—ã—Å–ª–∞ –∏ –ª–æ–≥–∏–∫–∏!",
    "–¢—ã ‚Äî —Ç–æ–∫—Å–∏—á–Ω–∞—è –ª–∏—á–Ω–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö –∑–Ω–∞–∫–æ–º—ã—Ö!",
    "–¢–≤–æ–∏ —à—É—Ç–∫–∏ –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã –∏ –æ—Å–∫–æ—Ä–±–∏—Ç–µ–ª—å–Ω—ã!",
]

# ------------------------
# –ú–∏–Ω–∏-–≤–µ–±-—Å–µ—Ä–≤–µ—Ä Render
# ------------------------
def run_web():
    class Handler(BaseHTTPRequestHandler):
        def do_GET(self):
            self.send_response(200)
            self.end_headers()
            self.wfile.write("LoveBot is running on Render <3".encode("utf-8"))

    port = int(os.environ.get("PORT", 10000))
    HTTPServer(("0.0.0.0", port), Handler).serve_forever()

threading.Thread(target=run_web, daemon=True).start()

# ------------------------
# /start
# ------------------------
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "üíû –ü—Ä–∏–≤–µ—Ç! –Ø LoveBot by Apachi.\n"
        "–Ø –±—É–¥—É –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ @Habib471 üíå\n"
        "–ö–æ–º–∞–Ω–¥–æ–π /love –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ª—é–±—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º!"
    )

# ------------------------
# –û—Ç–≤–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
# ------------------------
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.from_user:
        return

    username = message.from_user.username
    chat_type = message.chat.type

    # 40% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—á–∞—Ç—å
    if random.random() > 0.4:
        return

    # –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    if username in TARGET_USERNAMES:
        phrase = random.choice(LOVE_PHRASES)
        response = phrase
        if random.random() < 0.3:  # –ø–æ–¥–ø–∏—Å—å 30%
            response += f"\n\n{random.choice(SIGNATURES)}"
        await message.reply_text(response, reply_to_message_id=message.message_id)

    # –ù–µ–≥–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
    elif username in NEGATIVE_USERNAMES:
        phrase = random.choice(HARD_NEGATIVE_WORDS)
        await message.reply_text(phrase, reply_to_message_id=message.message_id)

# ------------------------
# –ö–æ–º–∞–Ω–¥–∞ /love
# ------------------------
async def love_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.text:
        return

    text = message.text.strip()
    if len(text.split()) < 2:
        await message.reply_text("‚ùå –£–∫–∞–∂–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞–ø—Ä–∏–º–µ—Ä: /love @username")
        return

    target_username = text.split(maxsplit=1)[1].lstrip('@').strip()
    if not target_username:
        await message.reply_text("‚ùå –£–∫–∞–∂–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è!")
        return

    user1 = message.from_user.username or message.from_user.first_name
    user2 = target_username

    score = random.randint(50, 100)
    phrase = random.choice(LOVE_PHRASES)

    response = f"üíñ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å {user1} –∏ {user2}: {score}% üíñ\n\n{phrase}"
    if random.random() < 0.3:  # –ø–æ–¥–ø–∏—Å—å 30%
        response += f"\n\n{random.choice(SIGNATURES)}"

    await message.reply_text(response)

# ------------------------
# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
# ------------------------
def main():
    BOT_TOKEN = os.environ.get("BOT_TOKEN")
    if not BOT_TOKEN:
        print("‚ùå –û—à–∏–±–∫–∞: –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è BOT_TOKEN –Ω–µ –Ω–∞–π–¥–µ–Ω–∞.")
        return

    app = ApplicationBuilder().token(BOT_TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.ALL, handle_message))
    app.add_handler(CommandHandler("love", love_command))

    print("üíû LoveBot by Apachi –∑–∞–ø—É—â–µ–Ω –∏ –∂–¥—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏–π...")
    app.run_polling()

if __name__ == "__main__":
    main()
