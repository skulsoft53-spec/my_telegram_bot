import os
import random
import threading
from http.server import BaseHTTPRequestHandler, HTTPServer
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, CommandHandler, filters, ContextTypes

# Пользователи
TARGET_USERNAMES = ["Habib471"]       # Романтика
NEGATIVE_USERNAMES = ["vkhich1ro"]    # Негатив

# 100 романтических фраз 💞
LOVE_PHRASES = [
    "Ты — моё вдохновение, нежное как дыхание весны 🌷",
    "С тобой всё вокруг наполняется смыслом 💫",
    "Ты — моя мелодия счастья, тихая и вечная 🎶",
    "В каждом луче солнца я вижу твой свет ☀️",
    "Ты — шёпот нежности в шуме мира 🌸",
    "Каждая мысль о тебе — как утренний рассвет 🌅",
    "С тобой даже тишина звучит прекраснее 💞",
    "Ты — дыхание света в моём сердце ✨",
    "В твоих глазах спрятано небо и тепло 🌌",
    "Ты — мечта, которая стала реальностью 💗",
    "С тобой даже ветер дышит любовью 🌬️",
    "Ты — причина улыбаться без причины 💕",
    "Твоё имя звучит как нежная песня 💖",
    "Ты — светлая мысль во всех моих днях 🌤️",
    "Когда ты рядом, всё остальное теряет значение 🌺",
    "Ты — мой дом, где покой и тепло 🕊️",
    "Каждая встреча с тобой — маленькое чудо ✨",
    "Ты — утренний луч в моём сердце 🌞",
    "С тобой даже звёзды сияют ярче 🌟",
    "Ты — капля любви в океане жизни 💧",
    "Ты — вдох, без которого не дышу 💫",
    "В твоих глазах — целая вселенная нежности 🌌",
    "Ты — слово ‘счастье’, написанное светом 💕",
    "Ты — мой якорь и мой полёт одновременно 💞",
    "Ты — мой уют даже в самых холодных днях ❄️",
    "Твоё присутствие делает этот мир мягче 🌸",
    "Ты — улыбка судьбы, которую я не хочу терять 💫",
    "Ты — аромат весны в моих мыслях 🌼",
    "С тобой мир обретает рифму и музыку 🎵",
    "Ты — мой лучик в мире сумраков 🌙",
    "Ты — нежность, обретшая форму 💗",
    "Каждое утро с тобой — праздник души 🌅",
    "Ты — тепло, что не уходит даже зимой 🔥",
    "Ты — мой смысл и моя простая радость 💞",
    "С тобой даже дождь поёт о любви 🌧️",
    "Ты — мгновение, которое хочется повторять 💖",
    "Ты — сладкий сон, который не хочется прерывать 🌙",
    "Ты — вдохновение каждой строки 💫",
    "Ты — мой маяк в океане чувств 🌊",
    "Ты — мягкий свет, что ведёт сквозь тьму 🌠",
    "Ты — чудо, к которому не перестаю тянуться 💗",
    "Ты — дыхание радости в каждом дне 💕",
    "Ты — отклик сердца на зов любви 💌",
    "Ты — нежный огонь в холодном мире 🔥",
    "С тобой даже молчание становится стихом 🌸",
    "Ты — моя самая красивая случайность 💫",
    "Ты — свет в каждом взгляде 💖",
    "Ты — утро, которое не хочется отпускать 🌅",
    "Ты — причина моего вдоха и улыбки 💞",
    "С тобой всё просто и всё по-настоящему ☀️",
    "Ты — мой стих, написанный звёздами 🌠",
    "Ты — прикосновение света к душе 💫",
    "Ты — песня, что звучит без слов 🎶",
    "Ты — дыхание тепла в моём сердце 💗",
    "Ты — улыбка, за которой скрыто солнце ☀️",
    "Ты — мой внутренний покой 🌙",
    "Ты — как лето в сердце зимой 🌺",
    "Ты — светлая нота моего дня 🎵",
    "Ты — мой нежный маяк в буре жизни 🌊",
    "Ты — шепот, что лечит душу 💞",
    "Ты — моя бесконечность в одном взгляде 💫",
    "Ты — смысл, что делает всё остальное ненужным 💖",
    "Ты — мой ангел среди людей 🕊️",
    "Ты — дыхание счастья 💗",
    "Ты — как стих, который хочется перечитывать 🌸",
    "Ты — улыбка, согревающая сердце 💞",
    "Ты — вдохновение моего вдоха 💫",
    "Ты — мечта, к которой ведут все пути 🌠",
    "Ты — нежность, обернутая в свет 🌷",
    "Ты — мой рассвет и мой закат одновременно 🌅",
    "Ты — мой ответ на все вопросы 💌",
    "Ты — чудо, о котором я молчал 💖",
    "Ты — нежность, что живёт в каждом мгновении 💞",
    "Ты — дыхание весны в холодном дне 🌸",
    "Ты — тепло, спрятанное в моих мыслях ☀️",
    "Ты — мой любимый хаос 💫",
    "Ты — поцелуй судьбы, оставшийся навсегда 💕",
    "Ты — вдохновение каждой капли дождя 🌧️",
    "Ты — огонь, что не обжигает 🔥",
    "Ты — тайна, которую не хочу разгадать 💌",
    "Ты — моя радость и свет в темноте 🌟",
    "Ты — мягкость в этом жестоком мире 💖",
    "С тобой каждая минута — чудо 💫",
    "Ты — любовь, которую хочется хранить 💕",
    "Ты — нежность, согревающая душу 🌷",
    "Ты — вдохновение моего сердца 💗",
    "Ты — мой свет в конце туннеля 🌅",
    "Ты — музыка в моих мыслях 🎶",
    "Ты — счастье, что стало реальностью 💞",
    "Ты — мечта, воплощённая в жизнь 🌸",
]

# Подписи к романтическим сообщениям
SIGNATURES = [
    "Апачи тебя любит ❤️",
    "Ты в сердце Апачи навсегда 💗",
    "Полюби Апачи, как он тебя 🌙",
    "От Апачи с теплом 💌",
]

# 100 жёстких негативных фраз 😡
HARD_NEGATIVE_WORDS = [
    "Ты абсолютно ненадёжный и раздражающий человек!",
    "Невозможно терпеть твою бездушную болтовню!",
    "Твоя пустая болтовня утомляет всех вокруг!",
    "Ты постоянно создаёшь хаос и раздражение!",
    "Твоё присутствие — это как серый туман уныния!",
    "Ты — источник всех проблем и неприятностей!",
    "Никакая логика не спасает твою безумную голову!",
    "Ты бездарно тратишь время и чужие нервы!",
    "Твои поступки вызывают только злость и разочарование!",
    "Ты не способен на доброту и честность!",
    "Твоя лживость поражает всех подряд!",
    "Ты несёшь разочарование куда бы ни пошёл!",
    "Невыносимо слушать твою бессмысленную речь!",
    "Ты — настоящая головная боль для всех!",
    "Твои слова только раздражают и оскорбляют!",
    "Ты постоянно создаёшь драму и негатив!",
    "Невозможно понять твою бессмысленную логику!",
    "Ты как чёрная дыра для счастья других!",
    "Твои действия разрушают всё вокруг!",
    "Ты — воплощение хаоса и безразличия!",
    "Ты — источник фрустрации для всех знакомых!",
    "Твоё присутствие портит настроение окружающим!",
    "Ты словно магнит для неприятностей и проблем!",
    "Невозможно терпеть твою самовлюблённость!",
    "Твоя жадность и эгоизм поражают всех!",
    "Ты — причина всех ссор и конфликтов!",
    "Твои слова ранят больше, чем действия!",
    "Ты только создаёшь стресс и тревогу!",
    "Твоя глупость поражает воображение!",
    "Ты — полное разочарование во всех смыслах!",
    "Твои действия постоянно вызывают раздражение!",
    "Ты разрушитель всего позитивного вокруг!",
    "Ты бездарно тратишь чужое время!",
    "Невыносимо находиться рядом с тобой!",
    "Ты как чума для настроения других людей!",
    "Ты превращаешь радость в скуку и грусть!",
    "Твоя безответственность поражает всех!",
    "Ты — постоянный источник хаоса!",
    "Твоя лень и равнодушие раздражают!",
    "Ты — причина всех ошибок команды!",
    "Твои действия лишены смысла и логики!",
    "Ты — токсичная личность для всех знакомых!",
    "Твои шутки неприятны и оскорбительны!",
    "Ты — постоянная проблема для всех рядом!",
    "Ты — чёрная тень в жизни каждого человека!",
    "Невыносимо наблюдать за твоей эгоистичной натурой!",
    "Ты — пример разрушительной личности!",
    "Твоя самоуверенность раздражает всех!",
    "Ты — воплощение безразличия и цинизма!",
    "Невозможно воспринимать твою лживость!",
    "Ты — источник всех конфликтов и ссор!",
    "Твои слова лишь ранят и обижают!",
    "Ты — постоянный генератор негатива!",
    "Твоя бездушность пугает окружающих!",
    "Ты — токсин для позитивного настроения!",
    "Невозможно терпеть твоё эгоистичное поведение!",
    "Ты разрушаешь всё вокруг своей глупостью!",
    "Твои поступки лишают радости других!",
    "Ты — воплощение цинизма и эгоизма!",
    "Ты как буря, уничтожающая всё вокруг!",
    "Твоя жестокость поражает воображение!",
    "Ты — разрушитель всего светлого и доброго!",
    "Твои слова ранят сильнее, чем действия!",
    "Ты — причина разочарований и злости!",
    "Твоя негативность заразительна!",
    "Ты словно магнит для неприятностей!",
    "Невозможно выносить твоё присутствие рядом!",
    "Ты — источник стресса для всех людей!",
    "Твои действия вызывают только раздражение!",
    "Ты — пример разрушительной личности для всех!",
    "Ты — вечная головная боль для окружения!",
    "Твоя жадность и злоба поражают!",
    "Ты — воплощение всего плохого в мире!",
    "Твоё присутствие портит настроение окружающим!",
    "Ты — постоянная проблема для команды!",
    "Твои действия вызывают хаос и разочарование!",
    "Ты — причина конфликтов и негатива!",
    "Ты лишаешь радости всех вокруг!",
    "Ты — как череда непрекращающихся проблем!",
    "Невыносимо наблюдать за твоей лживостью!",
    "Ты — воплощение раздражения и злости!",
]

# Мини-веб-сервер Render
def run_web():
    class Handler(BaseHTTPRequestHandler):
        def do_GET(self):
            self.send_response(200)
            self.end_headers()
            self.wfile.write("LoveBot is running on Render <3".encode("utf-8"))

    port = int(os.environ.get("PORT", 10000))
    HTTPServer(("0.0.0.0", port), Handler).serve_forever()

threading.Thread(target=run_web, daemon=True).start()

# /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "💞 Привет! Я LoveBot by Apachi.\n"
        "Я буду отвечать на каждое сообщение @Habib471 💌\n"
        "Командой /love вы можете проверить совместимость с любым пользователем!"
    )

# Ответ на сообщения выбранного пользователя
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.from_user:
        return

    username = message.from_user.username
    chance = random.random()
    # 30% шанс отвечать
    if message.chat.type in ["group", "supergroup"] and chance < 0.3:
        if username in TARGET_USERNAMES:
            phrase = random.choice(LOVE_PHRASES)
            if random.random() < 0.3:
                phrase += f"\n\n{random.choice(SIGNATURES)}"
        elif username in NEGATIVE_USERNAMES:
            phrase = random.choice(HARD_NEGATIVE_WORDS)
        else:
            return
        await message.reply_text(phrase, reply_to_message_id=message.message_id)

# Команда /love
async def love_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.text:
        return

    args = message.text.split(maxsplit=1)
    if len(args) < 2:
        await message.reply_text("❌ Укажи пользователя, например: /love @username")
        return

    target_username = args[1].lstrip('@')
    user1 = message.from_user.username or message.from_user.first_name
    user2 = target_username

    score = random.randint(50, 100)
    phrase = random.choice(LOVE_PHRASES)
    response = f"💖 Совместимость {user1} и {user2}: {score}% 💖\n\n{phrase}"
    if random.random() < 0.3:
        response += f"\n\n{random.choice(SIGNATURES)}"

    await update.message.reply_text(response)

def main():
    BOT_TOKEN = os.environ.get("BOT_TOKEN")
    if not BOT_TOKEN:
        print("❌ Ошибка: переменная BOT_TOKEN не найдена.")
        return

    app = ApplicationBuilder().token(BOT_TOKEN).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(MessageHandler(filters.ALL, handle_message))
    app.add_handler(CommandHandler("love", love_command))

    print("💞 LoveBot by Apachi запущен и ждёт сообщений...")
    app.run_polling()

if __name__ == "__main__":
    main()
