import os
import random
import threading
from http.server import BaseHTTPRequestHandler, HTTPServer
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, CommandHandler, filters, ContextTypes

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
TARGET_USERNAMES = ["Habib471"]  # –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

# –ö—Ä–∞—Å–∏–≤—ã–µ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—Ä–∞–∑—ã
LOVE_PHRASES = [
    "–¢—ã ‚Äî –ª—É—á–∏–∫ —Å–≤–µ—Ç–∞ –≤ –º–æ—ë–º –º–∏—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —É–≥–∞—Å–∞–µ—Ç üåÖ",
    "–ö–æ–≥–¥–∞ –¥—É–º–∞—é –æ —Ç–µ–±–µ, —Å–µ—Ä–¥—Ü–µ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ç–µ–ø–ª–æ–º –∏ —Ä–∞–¥–æ—Å—Ç—å—é üíñ",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –º–∏–≥ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–∞–ª–µ–Ω—å–∫–∏–º —á—É–¥–æ–º ‚ú®",
    "–¢–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî –º–æ—è –ª—é–±–∏–º–∞—è –º–µ–ª–æ–¥–∏—è –¥–Ω—è üé∂",
    "–¢—ã —Å–ª–æ–≤–Ω–æ –º—è–≥–∫–∏–π –≤–µ—Ç–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —É–Ω–æ—Å–∏—Ç –≤—Å–µ —Ç—Ä–µ–≤–æ–≥–∏ üå∏",
    "–í —Ç–≤–æ–∏—Ö –≥–ª–∞–∑–∞—Ö —è –Ω–∞—Ö–æ–∂—É –ø–æ–∫–æ–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ üåå",
    "–¢—ã ‚Äî –ø—Ä–∏—á–∏–Ω–∞ –º–æ–µ–≥–æ —Å—á–∞—Å—Ç—å—è –∏ —Ç–∏—Ö–æ–π —Ä–∞–¥–æ—Å—Ç–∏ üíû",
    "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –¥–æ–∂–¥–ª–∏–≤—ã–π –¥–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —Å–≤–µ—Ç–ª—ã–º üåßÔ∏è‚òÄÔ∏è",
    "–¢—ã ‚Äî –Ω–µ–∂–Ω—ã–π —Å–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–µ–¥—ë—Ç –º–µ–Ω—è —á–µ—Ä–µ–∑ —Ç—å–º—É üå†",
    "–ö–∞–∂–¥–æ–µ —Ç–≤–æ—ë —Å–ª–æ–≤–æ –∑–≤—É—á–∏—Ç –∫–∞–∫ –ø–æ—ç–º–∞ –¥–ª—è –º–æ–µ–π –¥—É—à–∏ üí´",
    "–¢—ã ‚Äî —Å–ª–æ–≤–Ω–æ —É—Ç—Ä–µ–Ω–Ω–∏–π —Ä–∞—Å—Å–≤–µ—Ç, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–≥—Ä–µ–≤–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ üåÑ",
    "–° —Ç–æ–±–æ–π –º–∏—Ä –∫–∞–∂–µ—Ç—Å—è —è—Ä—á–µ, —Ç–µ–ø–ª–µ–µ –∏ –¥–æ–±—Ä–µ–µ ‚òÄÔ∏è",
    "–¢—ã ‚Äî —Ç–∞–π–Ω–∞, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç—Å—è —Ä–∞–∑–≥–∞–¥—ã–≤–∞—Ç—å —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ üíå",
    "–í —Ç–≤–æ—ë–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞—Å—Ç–≤–æ—Ä—è—é—Ç—Å—è –≤—Å–µ —Ç—Ä–µ–≤–æ–≥–∏ –∏ —Å–æ–º–Ω–µ–Ω–∏—è üå∑",
    "–¢—ã ‚Äî –¥—ã—Ö–∞–Ω–∏–µ —Å—á–∞—Å—Ç—å—è, —á—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –æ—Å–æ–±–µ–Ω–Ω—ã–º üíó",
    "–¢–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî —ç—Ç–æ —Å–æ–ª–Ω—Ü–µ, —Å–≤–µ—Ç—è—â–µ–µ –≤ –º–æ–µ–π –¥—É—à–µ üåû",
    "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –º–µ—á—Ç–∞—Ç—å, —Ç–≤–æ—Ä–∏—Ç—å –∏ –ø—Ä–æ—Å—Ç–æ –∂–∏—Ç—å ‚ú®",
    "–¢—ã ‚Äî –≥–∞—Ä–º–æ–Ω–∏—è –≤ —à—É–º–Ω–æ–º –º–∏—Ä–µ, —Ç–∏—Ö–∞—è –∏ –Ω–µ–∂–Ω–∞—è üå∏",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥–æ–µ –º–≥–Ω–æ–≤–µ–Ω–∏–µ ‚Äî –∫–∞–∫ –º–∞–ª–µ–Ω—å–∫–∞—è –≤—Å–µ–ª–µ–Ω–Ω–∞—è üí´",
    "–¢—ã ‚Äî —Ä–∞–¥–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é –Ω–µ–ª—å–∑—è –æ–ø–∏—Å–∞—Ç—å —Å–ª–æ–≤–∞–º–∏ üíï",
    "–° —Ç–æ–±–æ–π –¥–∞–∂–µ –º–æ–ª—á–∞–Ω–∏–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º–µ–ª–æ–¥–∏–µ–π üéµ",
    "–¢—ã ‚Äî –º—è–≥–∫–∏–π —Å–≤–µ—Ç –≤ —Ö–æ–ª–æ–¥–Ω—ã–µ –¥–Ω–∏, —Ç–µ–ø–ª–æ –≤ —Å–µ—Ä–¥—Ü–µ üåπ",
    "–¢–≤–æ–∏ –≥–ª–∞–∑–∞ ‚Äî –∫–∞–∫ –æ–∑—ë—Ä–∞ —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è üåä",
    "–¢—ã ‚Äî –∑–∞–≥–∞–¥–∫–∞, –∫ –∫–æ—Ç–æ—Ä–æ–π —Ö–æ—á–µ—Ç—Å—è –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ üîÆ",
    "–° —Ç–æ–±–æ–π –≤—Å—ë –≤–æ–∫—Ä—É–≥ –Ω–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–º—ã—Å–ª–æ–º –∏ –∫—Ä–∞—Å–æ—Ç–æ–π üå∫",
    "–¢—ã ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ –∫–∞–∂–¥–æ–π –º–æ–µ–π –º—ã—Å–ª–∏ –∏ –º–µ—á—Ç—ã üåü",
    "–¢–≤–æ—è –¥–æ–±—Ä–æ—Ç–∞ ‚Äî –∫–∞–∫ —Ç—ë–ø–ª—ã–π –ø–ª–µ–¥ –≤ –∑–∏–º–Ω—é—é —Å—Ç—É–∂—É ‚ùÑÔ∏è",
    "–¢—ã ‚Äî –º–æ–π –º–∞—è–∫, —á—Ç–æ —É–∫–∞–∑—ã–≤–∞–µ—Ç –ø—É—Ç—å –≤ –ª—é–±–æ–π –±—É—Ä–µ ‚õµ",
    "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è —Å–º–µ—è—Ç—å—Å—è, –º–µ—á—Ç–∞—Ç—å –∏ –ª—é–±–∏—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ üíû",
    "–¢—ã ‚Äî –º—É–∑—ã–∫–∞, —á—Ç–æ –∑–≤—É—á–∏—Ç –≤ –º–æ–µ–π –¥—É—à–µ –±–µ–∑ —Å–ª–æ–≤ üé∂",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –ø–æ—Ö–æ–∂ –Ω–∞ —Å–∫–∞–∑–∫—É, –ø–æ–ª–Ω—É—é —á—É–¥–µ—Å ‚ú®",
    "–¢—ã ‚Äî —Å–≤–µ—Ç, —á—Ç–æ —Å–æ–≥—Ä–µ–≤–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ –¥–∞–∂–µ –≤ –Ω–æ—á–∏ üåô",
    "–¢–≤–æ—è —É–ª—ã–±–∫–∞ ‚Äî –º–æ–π –ª–∏—á–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ —Ä–∞–¥–æ—Å—Ç–∏ –∏ —Å—á–∞—Å—Ç—å—è üå∏",
    "–° —Ç–æ–±–æ–π –ª–µ–≥–∫–æ –¥—ã—à–∞—Ç—å, –º–µ—á—Ç–∞—Ç—å –∏ –∂–∏—Ç—å –Ω–∞—Å—Ç–æ—è—â–∏–º –º–æ–º–µ–Ω—Ç–æ–º üíó",
    "–¢—ã ‚Äî —Å–ª–æ–≤–Ω–æ –º—è–≥–∫–∏–π –¥–æ–∂–¥—å –≤–µ—Å–Ω–æ–π, —á—Ç–æ –æ–º—ã–≤–∞–µ—Ç –≤—Å—ë –≤–æ–∫—Ä—É–≥ üåßÔ∏è",
    "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ ‚Äî —Å–ª–æ–≤–Ω–æ –Ω–µ–∂–Ω—ã–µ –ø—Ä–∏–∫–æ—Å–Ω–æ–≤–µ–Ω–∏—è –∫ –¥—É—à–µ üíå",
    "–¢—ã ‚Äî —á—É–¥–æ, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—á–µ—Ç—Å—è —Ö—Ä–∞–Ω–∏—Ç—å –∏ –±–µ—Ä–µ—á—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üíñ",
    "–° —Ç–æ–±–æ–π –¥–∞–∂–µ —Å–∞–º—ã–π –æ–±—ã—á–Ω—ã–π –¥–µ–Ω—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≤–æ–ª—à–µ–±–Ω—ã–º üåû",
    "–¢—ã ‚Äî –∏—Å—Ç–æ—á–Ω–∏–∫ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è –∏ —Ç–µ–ø–ª–∞ –¥–ª—è –º–æ–µ–≥–æ —Å–µ—Ä–¥—Ü–∞ ‚ú®",
    "–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –¥–µ–ª–∞–µ—Ç –º–∏—Ä —è—Ä—á–µ –∏ —Ä–∞–¥–æ—Å—Ç–Ω–µ–µ üå∑",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –º–∏–≥ ‚Äî —ç—Ç–æ –º–∞–ª–µ–Ω—å–∫–æ–µ —Å–æ–∫—Ä–æ–≤–∏—â–µ üíé",
    "–¢—ã ‚Äî —Ç–∏—Ö–∞—è –º–µ–ª–æ–¥–∏—è —Å—á–∞—Å—Ç—å—è, –∫–æ—Ç–æ—Ä–∞—è –∏–≥—Ä–∞–µ—Ç –≤ —Å–µ—Ä–¥—Ü–µ üéµ",
    "–¢–≤–æ—è –Ω–µ–∂–Ω–æ—Å—Ç—å —Å–ª–æ–≤–Ω–æ –º—è–≥–∫–æ–µ –ø–æ–∫—Ä—ã–≤–∞–ª–æ –≤ —Ö–æ–ª–æ–¥–Ω—ã–π –≤–µ—á–µ—Ä ‚ùÑÔ∏è",
    "–° —Ç–æ–±–æ–π —Ö–æ—á–µ—Ç—Å—è –ª–µ—Ç–∞—Ç—å, –º–µ—á—Ç–∞—Ç—å –∏ —Å–º–µ—è—Ç—å—Å—è –±–µ–∑ —É—Å—Ç–∞–ª–∏ üí´",
    "–¢—ã ‚Äî –≥–∞—Ä–º–æ–Ω–∏—è –∏ —É—é—Ç –≤ –º–æ—ë–º –º–∏—Ä–µ üå∫",
    "–¢–≤–æ–∏ –≥–ª–∞–∑–∞ —Å–∏—è—é—Ç —è—Ä—á–µ –≤—Å–µ—Ö –∑–≤—ë–∑–¥ –Ω–∞ –Ω–µ–±–µ üåü",
    "–° —Ç–æ–±–æ–π –º–∏—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –º—è–≥–∫–∏–º, —Ç—ë–ø–ª—ã–º –∏ –¥–æ–±—Ä—ã–º ‚òÄÔ∏è",
    "–¢—ã ‚Äî –ø–æ—ç–∑–∏—è, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç—Å—è —á–∏—Ç–∞—Ç—å —Å–Ω–æ–≤–∞ –∏ —Å–Ω–æ–≤–∞ üåπ",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥–∞—è –º–∏–Ω—É—Ç–∞ ‚Äî –∫–∞–∫ —Å–ª–∞–¥–∫–∞—è –º–µ—á—Ç–∞ üíñ",
    "–¢—ã ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∑–∞—Å—Ç–∞–≤–ª—è–µ—Ç —Å–µ—Ä–¥—Ü–µ –±–∏—Ç—å—Å—è —á–∞—â–µ üíó",
    "–° —Ç–æ–±–æ–π –∂–∏–∑–Ω—å –∫–∞–∂–µ—Ç—Å—è –ª—ë–≥–∫–æ–π, –∫—Ä–∞—Å–∏–≤–æ–π –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ–π —Å–º—ã—Å–ª–æ–º üå∏",
    "–¢—ã ‚Äî –Ω–µ–∂–Ω–æ—Å—Ç—å, –∫–æ—Ç–æ—Ä—É—é —Ö–æ—á–µ—Ç—Å—è –æ–±–Ω–∏–º–∞—Ç—å –∫–∞–∂–¥—ã–π –¥–µ–Ω—å üíû",
]

# –ü–æ–¥–ø–∏—Å–∏ –∫ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–æ–±—â–µ–Ω–∏—è–º
SIGNATURES = [
    "–ê–ø–∞—á–∏ —Ç–µ–±—è –ª—é–±–∏—Ç ‚ù§Ô∏è",
    "–¢—ã –≤ —Å–µ—Ä–¥—Ü–µ –ê–ø–∞—á–∏ –Ω–∞–≤—Å–µ–≥–¥–∞ üíó",
    "–ü–æ–ª—é–±–∏ –ê–ø–∞—á–∏, –∫–∞–∫ –æ–Ω —Ç–µ–±—è üåô",
    "–û—Ç –ê–ø–∞—á–∏ —Å —Ç–µ–ø–ª–æ–º üíå",
]

# –ú–∏–Ω–∏-–≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è Render/Heroku
def run_web():
    class Handler(BaseHTTPRequestHandler):
        def do_GET(self):
            self.send_response(200)
            self.end_headers()
            self.wfile.write(b"LoveBot is running <3")
    port = int(os.environ.get("PORT", 10000))
    HTTPServer(("0.0.0.0", port), Handler).serve_forever()

threading.Thread(target=run_web, daemon=True).start()

# –ü–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —á—Ç–æ–±—ã –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–ª–æ—Å—å
last_messages = {}

# /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "üíû –ü—Ä–∏–≤–µ—Ç! –Ø LoveBot by Apachi.\n"
        "–Ø –æ—Ç–≤–µ—á–∞—é –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π üíå\n"
        "–ö–æ–º–∞–Ω–¥–æ–π /love –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å!"
    )

# –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.from_user:
        return
    username = message.from_user.username
    phrase = None
    if message.chat.type in ["group", "supergroup"]:
        if username in TARGET_USERNAMES and random.random() < 0.3:  # 30% —Å–æ–æ–±—â–µ–Ω–∏–π
            while True:
                phrase = random.choice(LOVE_PHRASES)
                if last_messages.get(username) != phrase:
                    last_messages[username] = phrase
                    break
        if phrase:
            response = phrase
            if random.random() < 0.3:  # 30% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–ø–∏—Å—å
                response += f"\n\n{random.choice(SIGNATURES)}"
            await message.reply_text(response, reply_to_message_id=message.message_id)

# –ö–æ–º–∞–Ω–¥–∞ /love
async def love_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.text:
        return
    args = message.text.split(maxsplit=1)
    target = args[1] if len(args) > 1 else message.from_user.username
    score = random.randint(50, 100)
    await message.reply_text(f"üíû –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å {target}: {score}%")

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
async def main():
    token = os.environ.get("TELEGRAM_TOKEN")  # –í Render –¥–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è TELEGRAM_TOKEN
    app = ApplicationBuilder().token(token).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("love", love_command))
    app.add_handler(MessageHandler(filters.TEXT & (~filters.COMMAND), handle_message))
    await app.run_polling()

if __name__ == "__main__":
    import asyncio
    asyncio.run(main())
