import os
import random
import threading
from http.server import BaseHTTPRequestHandler, HTTPServer
from telegram import Update
from telegram.ext import ApplicationBuilder, MessageHandler, CommandHandler, filters, ContextTypes

# Пользователи
TARGET_USERNAMES = ["Habib471"]
NEGATIVE_USERNAMES = ["vkhich1ro"]

# 100 романтических фраз 💞
LOVE_PHRASES = [
    "Ты — моё вдохновение, нежное как дыхание весны 🌷",
    "С тобой всё вокруг наполняется смыслом 💫",
    "Ты — моя мелодия счастья, тихая и вечная 🎶",
    "В каждом луче солнца я вижу твой свет ☀️",
    "Ты — шёпот нежности в шуме мира 🌸",
    "Каждая мысль о тебе — как утренний рассвет 🌅",
    "С тобой даже тишина звучит прекраснее 💞",
    "Ты — дыхание света в моём сердце ✨",
    "В твоих глазах спрятано небо и тепло 🌌",
    "Ты — мечта, которая стала реальностью 💗",
    "С тобой даже ветер дышит любовью 🌬️",
    "Ты — причина улыбаться без причины 💕",
    "Твоё имя звучит как нежная песня 💖",
    "Ты — светлая мысль во всех моих днях 🌤️",
    "Когда ты рядом, всё остальное теряет значение 🌺",
    "Ты — мой дом, где покой и тепло 🕊️",
    "Каждая встреча с тобой — маленькое чудо ✨",
    "Ты — утренний луч в моём сердце 🌞",
    "С тобой даже звёзды сияют ярче 🌟",
    "Ты — капля любви в океане жизни 💧",
    "Ты — вдох, без которого не дышу 💫",
    "В твоих глазах — целая вселенная нежности 🌌",
    "Ты — слово 'счастье', написанное светом 💕",
    "Ты — мой якорь и мой полёт одновременно 💞",
    "Ты — мой уют даже в самых холодных днях ❄️",
    "Твоё присутствие делает этот мир мягче 🌸",
    "Ты — улыбка судьбы, которую я не хочу терять 💫",
    "Ты — аромат весны в моих мыслях 🌼",
    "С тобой мир обретает рифму и музыку 🎵",
    "Ты — мой лучик в мире сумраков 🌙",
    "Ты — нежность, обретшая форму 💗",
    "Каждое утро с тобой — праздник души 🌅",
    "Ты — тепло, что не уходит даже зимой 🔥",
    "Ты — мой смысл и моя простая радость 💞",
    "С тобой даже дождь поёт о любви 🌧️",
    "Ты — мгновение, которое хочется повторять 💖",
    "Ты — сладкий сон, который не хочется прерывать 🌙",
    "Ты — вдохновение каждой строки 💫",
    "Ты — мой маяк в океане чувств 🌊",
    "Ты — мягкий свет, что ведёт сквозь тьму 🌠",
    "Ты — чудо, к которому не перестаю тянуться 💗",
    "Ты — дыхание радости в каждом дне 💕",
    "Ты — отклик сердца на зов любви 💌",
    "Ты — нежный огонь в холодном мире 🔥",
    "С тобой даже молчание становится стихом 🌸",
    "Ты — моя самая красивая случайность 💫",
    "Ты — свет в каждом взгляде 💖",
    "Ты — утро, которое не хочется отпускать 🌅",
    "Ты — причина моего вдоха и улыбки 💞",
    "С тобой всё просто и всё по-настоящему ☀️",
    "Ты — мой стих, написанный звёздами 🌠",
    "Ты — прикосновение света к душе 💫",
    "Ты — песня, что звучит без слов 🎶",
    "Ты — дыхание тепла в моём сердце 💗",
    "Ты — улыбка, за которой скрыто солнце ☀️",
    "Ты — мой внутренний покой 🌙",
    "Ты — как лето в сердце зимой 🌺",
    "Ты — светлая нота моего дня 🎵",
    "Ты — мой нежный маяк в буре жизни 🌊",
    "Ты — шепот, что лечит душу 💞",
    "Ты — моя бесконечность в одном взгляде 💫",
    "Ты — смысл, что делает всё остальное ненужным 💖",
    "Ты — мой ангел среди людей 🕊️",
    "Ты — дыхание счастья 💗",
    "Ты — как стих, который хочется перечитывать 🌸",
    "Ты — улыбка, согревающая сердце 💞",
    "Ты — вдохновение моего вдоха 💫",
    "Ты — мечта, к которой ведут все пути 🌠",
    "Ты — нежность, обернутая в свет 🌷",
    "Ты — мой рассвет и мой закат одновременно 🌅",
    "Ты — мой ответ на все вопросы 💌",
    "Ты — чудо, о котором я молчал 💖",
    "Ты — нежность, что живёт в каждом мгновении 💞",
    "Ты — дыхание весны в холодном дне 🌸",
    "Ты — тепло, спрятанное в моих мыслях ☀️",
    "Ты — мой любимый хаос 💫",
    "Ты — поцелуй судьбы, оставшийся навсегда 💕",
    "Ты — вдохновение каждой капли дождя 🌧️",
    "Ты — огонь, что не обжигает 🔥",
    "Ты — тайна, которую не хочу разгадать 💌",
    "Ты — сладкий аромат утреннего счастья 🌹",
    "Ты — моя нежная песня под дождём 🎵",
    "С тобой хочется летать и смеяться 🌤️",
    "Ты — мой солнечный свет после грозы 🌈",
    "Ты — тихий уют в шумном мире 🕊️",
    "Ты — мои любимые мысли и мечты 💭",
    "С тобой каждая минута — драгоценна ⏳",
    "Ты — искра тепла в холодной вселенной 🔥",
    "Ты — гармония в хаосе жизни 🌿",
    "С тобой сердце наполняется радостью 💓",
    "Ты — мой ангел, что шепчет любовь 💞",
    "Ты — лучик света в серых днях 🌤️",
    "С тобой хочется творить чудеса ✨",
    "Ты — сладость моего существования 🍯",
    "Ты — вдохновение каждой моей улыбки 😄",
    "Ты — мелодия счастья для души 🎶",
    "Ты — мягкая тёплая волна любви 🌊",
]

# 100 негативных фраз ❌
NEGATIVE_PHRASES = [
    "Ты раздражаешь своей глупостью 😒",
    "С тобой всё скучно и однообразно 😑",
    "Ты словно туча на солнечном небе ☁️",
    "Твоё присутствие портит настроение 😤",
    "Ты — ошибка природы ❌",
    "С тобой всё кажется серым и пустым 🌫️",
    "Ты мешаешь дышать спокойно 😷",
    "Твои слова — пустой звук 🗑️",
    "С тобой хочется убежать 🏃‍♂️",
    "Ты — источник хаоса и проблем ⚡",
    "Ты постоянно раздражаешь 😡",
    "С тобой невозможно спокойно общаться 😤",
    "Ты словно гром среди ясного неба ⛈️",
    "Твоя компания утомляет 😴",
    "Ты как черная дыра для счастья 🕳️",
    "Твои действия бессмысленны 🙄",
    "С тобой неприятно молчать 😑",
    "Ты — головная боль 😖",
    "Твои шутки не смешные 😂❌",
    "С тобой всё вокруг становится хуже 🌪️",
    "Ты — барьер для счастья 🚫",
    "Твои идеи бесполезны 💀",
    "Ты мешаешь жить спокойно 🛑",
    "Твоя энергия отталкивает ❌",
    "Ты словно тень, которая давит 🌑",
    "С тобой трудно дышать 💨❌",
    "Твои поступки глупы 🙃",
    "Ты создаёшь хаос повсюду ⚡",
    "С тобой скучно до ужаса 😴",
    "Ты отнимаешь радость 💔",
    "Твои слова режут слух 👂❌",
    "Ты — источник проблем 🔥",
    "С тобой всё становится серым 🌫️",
    "Ты отравляешь атмосферу ☠️",
    "Твои взгляды угнетают 😒",
    "Ты мешаешь сосредоточиться 🧠",
    "Твоя глупость поражает 🤦",
    "С тобой нет вдохновения ❌",
    "Ты — камень на дороге счастья 🪨",
    "Твои попытки смешны 🤡",
    "Ты отнимаешь время ⏳❌",
    "С тобой невозможно радоваться 😔",
    "Ты — антипример для всех 🚫",
    "Твоя энергия разрушает ⚡",
    "Ты постоянно раздражаешь 😡",
    "С тобой каждый день тягостен 😞",
    "Ты словно дождь без солнца 🌧️",
    "Твои советы бесполезны 🙄",
    "Ты — угроза гармонии ⚠️",
    "С тобой нет света 🌑",
    "Ты разрушаешь настроение 😤",
    "Твои слова пусты 💨",
    "Ты — облако, закрывающее солнце ☁️",
    "С тобой всё хуже ❌",
    "Ты словно холодная стена 🧊",
    "Твоя тень гнетёт 😒",
    "Ты не приносишь радость 😞",
    "С тобой всё становится серым 🌫️",
    "Ты — источник разочарования 💔",
    "Твоя энергия давит ❌",
    "Ты мешаешь улыбаться 😑",
    "С тобой тишина пугает 😨",
    "Ты словно тяжёлый камень 🪨",
    "Твоя речь раздражает 👂",
    "Ты отнимаешь спокойствие 🛑",
    "С тобой нет радости 😔",
    "Ты — источник скуки 😒",
    "Твои действия глупы 🙃",
    "Ты создаёшь хаос ⚡",
    "С тобой невозможно веселиться 😤",
    "Ты словно тень 🌑",
    "Твоя энергия разрушает 🔥",
    "Ты отравляешь атмосферу ☠️",
    "С тобой всё уныло 😞",
    "Ты лишаешь радости 💔",
    "Твои советы глупы 🤦",
    "Ты мешаешь счастью 🚫",
    "С тобой скучно 😴",
    "Ты — препятствие к свету 🌫️",
    "Твои слова пустые 💨",
    "Ты — источник раздражения 😡",
    "С тобой ничего не радует 😔",
    "Ты словно холодный ветер 🌬️",
    "Твоя тень давит на сердце 🖤",
    "Ты мешаешь мечтать ❌",
    "С тобой невозможно веселиться 😑",
    "Ты — причина усталости 😴",
    "Твои действия бессмысленны 🙄",
    "С тобой день становится серым 🌫️",
    "Ты отнимаешь вдохновение 💨",
    "Твоя энергия разрушительна ⚡",
    "Ты словно дождь без радуги 🌧️",
    "С тобой всё тяжелее ❌",
]

# Подписи
SIGNATURES = [
    "Апачи тебя любит ❤️",
    "Ты в сердце Апачи навсегда 💗",
    "Полюби Апачи, как он тебя 🌙",
    "От Апачи с теплом 💌",
]

# Мини-веб-сервер Render
def run_web():
    class Handler(BaseHTTPRequestHandler):
        def do_GET(self):
            self.send_response(200)
            self.end_headers()
            self.wfile.write("LoveBot is running on Render <3".encode("utf-8"))

    port = int(os.environ.get("PORT", 10000))
    HTTPServer(("0.0.0.0", port), Handler).serve_forever()

threading.Thread(target=run_web, daemon=True).start()

# /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "💞 Привет! Я LoveBot by Apachi.\n"
        "Я буду отвечать на каждое сообщение @Habib471 💌\n"
        "Командой /love вы можете проверить совместимость с любым пользователем!"
    )

# Автоответ
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.from_user:
        return

    username = message.from_user.username
    if message.chat.type in ["group", "supergroup"]:
        if username in TARGET_USERNAMES:
            phrase = random.choice(LOVE_PHRASES)
        elif username in NEGATIVE_USERNAMES:
            phrase = random.choice(NEGATIVE_PHRASES)
        else:
            return

        if random.random() < 0.3:
            phrase += f"\n\n{random.choice(SIGNATURES)}"

        await message.reply_text(phrase, reply_to_message_id=message.message_id)

# /love
async def love_command(update: Update, context: ContextTypes.DEFAULT_TYPE):
    message = update.message
    if not message or not message.text:
        return

    args = message.text.split(maxsplit=1)
    if len(args) < 2:
        await message.reply_text("❌ Укажи пользователя, например: /love @username")
        return

    target_username = args[1].lstrip('@')
    user1 = message.from_user.username or message.from_user.first_name
    user2 = target_username

    score = random.randint(50, 100)
    phrase = random.choice(LOVE_PHRASES)
    response = f"💖 Совместимость {user1} и {user2}: {score}% 💖\n\n{phrase}"

    if random.random() < 0.3:
        response += f"\n\n{random.choice(SIGNATURES)}"

    await message.reply_text(response)

def main():
    BOT_TOKEN = os.environ.get("BOT_TOKEN")
    if not BOT_TOKEN:
        print("❌ Ошибка: переменная BOT_TOKEN не найдена.")
        return
